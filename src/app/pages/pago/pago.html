<div class="pago-container">
  <!-- Animated background -->
  <div class="bg-animation">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <!-- Header bancario -->
  <header class="bank-header">
    <div class="bank-logo">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
        <line x1="1" y1="10" x2="23" y2="10"></line>
      </svg>
      <span>TechPay Secure</span>
    </div>
    <div class="security-badge">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
        <path d="M9 12l2 2 4-4"></path>
      </svg>
      <span>Conexión Segura</span>
    </div>
  </header>

  <div class="content-wrapper">
    <!-- Resumen de compra -->
    <div class="purchase-summary">
      <h2>Resumen de tu Compra</h2>
      <div class="summary-card">
        <div class="summary-item">
          <span>Número de Orden:</span>
          <strong>{{ ventaData?.numero }}</strong>
        </div>
        <div class="summary-item">
          <span>Productos:</span>
          <strong>{{ ventaData?.productos?.length }} item(s)</strong>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-item total">
          <span>Total a Pagar:</span>
          <strong class="amount">${{ ventaData?.total | number:'1.0-0' }}</strong>
        </div>
      </div>
    </div>

    <!-- Formulario de pago -->
    <div class="payment-form">
      <h2>Datos de Pago</h2>
      
      <form (ngSubmit)="procesarPago()">
        <!-- Tarjeta -->
        <div class="card-preview" [class.flipped]="cardFlipped">
          <div class="card-front">
            <div class="card-chip"></div>
            <div class="card-number">{{ formatCardNumber(tarjetaData.numero) }}</div>
            <div class="card-info">
              <div class="card-holder">
                <label>Titular</label>
                <div>{{ tarjetaData.titular || 'NOMBRE APELLIDO' }}</div>
              </div>
              <div class="card-expiry">
                <label>Vencimiento</label>
                <div>{{ formatExpiry(tarjetaData.vencimiento) }}</div>
              </div>
            </div>
            <div class="card-brand">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="9" cy="12" r="6"></circle>
                <circle cx="15" cy="12" r="6"></circle>
              </svg>
            </div>
          </div>
          <div class="card-back">
            <div class="card-stripe"></div>
            <div class="card-cvv">
              <label>CVV</label>
              <div>{{ tarjetaData.cvv || '***' }}</div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
              <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
            Número de Tarjeta *
          </label>
          <input 
            [(ngModel)]="tarjetaData.numero" 
            name="numero"
            type="text" 
            placeholder="1234 5678 9012 3456"
            maxlength="19"
            (input)="onCardNumberInput($event)"
            required
            class="styled-input">
        </div>

        <div class="form-group">
          <label>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            Nombre del Titular *
          </label>
          <input 
            [(ngModel)]="tarjetaData.titular" 
            name="titular"
            type="text" 
            placeholder="JUAN PÉREZ"
            (input)="toUpperCase($event)"
            required
            class="styled-input">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              Vencimiento *
            </label>
            <input 
              [(ngModel)]="tarjetaData.vencimiento" 
              name="vencimiento"
              type="text" 
              placeholder="MM/AA"
              maxlength="5"
              (input)="onExpiryInput($event)"
              required
              class="styled-input">
          </div>

          <div class="form-group">
            <label>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              CVV *
            </label>
            <input 
              [(ngModel)]="tarjetaData.cvv" 
              name="cvv"
              type="text" 
              placeholder="123"
              maxlength="3"
              (focus)="cardFlipped = true"
              (blur)="cardFlipped = false"
              (input)="onlyNumbers($event)"
              required
              class="styled-input">
          </div>
        </div>

        <div *ngIf="error" class="error-message">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          <span>{{ error }}</span>
        </div>

        <button 
          type="submit" 
          class="btn-pay"
          [disabled]="procesando"
          [class.processing]="procesando">
          <svg *ngIf="!procesando" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            <path d="M9 12l2 2 4-4"></path>
          </svg>
          <div *ngIf="procesando" class="spinner"></div>
          <span>{{ procesando ? 'Procesando Pago...' : 'Pagar $' + (ventaData?.total | number:'1.0-0') }}</span>
        </button>

        <div class="security-info">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 16v-4"></path>
            <path d="M12 8h.01"></path>
          </svg>
          <span>Tus datos están protegidos con encriptación de 256 bits</span>
        </div>
      </form>
    </div>
  </div>
</div>
