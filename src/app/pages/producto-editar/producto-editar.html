<div class="container">
  <h2>Editar Producto</h2>

  <div *ngIf="loading" class="loading">Cargando...</div>

  <form *ngIf="!loading" (ngSubmit)="actualizar()">
    <div class="form-group">
      <label>CÃ³digo</label>
      <input 
        [(ngModel)]="producto.codigo" 
        name="codigo"
        type="text" 
        disabled>
    </div>

    <div class="form-group">
      <label>Nombre *</label>
      <input 
        [(ngModel)]="producto.nombre" 
        name="nombre"
        type="text" 
        required>
    </div>

    <div class="form-group">
      <label>Stock *</label>
      <input 
        [(ngModel)]="producto.stock" 
        name="stock"
        type="number" 
        min="0"
        required>
    </div>

    <div class="form-group">
      <label>Precio *</label>
      <input 
        [(ngModel)]="producto.precio" 
        name="precio"
        type="number" 
        min="0"
        step="0.01"
        required>
    </div>

    <!-- ğŸ“¸ SecciÃ³n de Imagen del Producto -->
    <div class="form-group">
      <label>ğŸ“¸ Imagen del Producto</label>

      <!-- Selector de archivo -->
      <div class="image-upload-container" *ngIf="!imagenPreview">
        <input 
          type="file" 
          id="fileInputEdit"
          (change)="onFileSelected($event)"
          accept="image/jpeg,image/jpg,image/png,image/gif,image/webp,image/bmp"
          class="file-input"
          #fileInput>
        <label for="fileInputEdit" class="file-label">
          ğŸ“¤ Seleccionar imagen
          <small>JPG, PNG, GIF, WEBP, BMP (Max. 5MB)</small>
        </label>
      </div>

      <!-- Preview de la imagen -->
      <div class="image-preview-container" *ngIf="imagenPreview">
        <div class="image-preview">
          <img [src]="imagenPreview" [alt]="producto.nombre || 'Preview'">
          <button type="button" class="btn-delete-image" (click)="eliminarImagen()">ğŸ—‘ï¸</button>
        </div>
        <div class="image-info" *ngIf="archivoSeleccionado">
          <span class="image-name">ğŸ“ {{ getNombreArchivo() }}</span>
          <span class="image-size">{{ getTamanioArchivo() }}</span>
        </div>
      </div>

      <!-- Loading state -->
      <div class="loading-image" *ngIf="cargandoImagen">
        <div class="spinner"></div>
        <span>Procesando imagen...</span>
      </div>

      <!-- Error de imagen -->
      <div *ngIf="errorImagen" class="error-message">{{ errorImagen }}</div>
    </div>

    <div class="form-group">
      <label>ğŸ“ DescripciÃ³n</label>
      <textarea 
        [(ngModel)]="producto.descripcion" 
        name="descripcion"
        rows="4"
        placeholder="DescripciÃ³n del producto"
        class="form-control">
      </textarea>
    </div>

    <div *ngIf="error" class="error-message">{{ error }}</div>
    <div *ngIf="success" class="success-message">{{ success }}</div>

    <div class="form-actions">
      <button type="button" class="btn-secondary" (click)="cancelar()">Cancelar</button>
      <button 
        type="button" 
        class="btn-ia" 
        (click)="generarDescripcionIA()"
        [disabled]="cargandoDescripcion || !producto.id">
        <span *ngIf="!cargandoDescripcion">ğŸ¤– Generar con IA</span>
        <span *ngIf="cargandoDescripcion">Generando...</span>
      </button>
      <button type="submit" class="btn-primary">Actualizar</button>
    </div>
  </form>
</div>
