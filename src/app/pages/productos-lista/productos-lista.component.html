<div class="productos-container">
  <!-- Animated background elements -->
  <div class="bg-animation">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <div class="content-wrapper">
    <!-- Header mejorado -->
    <div class="header">
      <div class="header-content">
        <div class="title-section">
          <div class="icon-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
              <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
              <line x1="6" y1="6" x2="6.01" y2="6"></line>
              <line x1="6" y1="18" x2="6.01" y2="18"></line>
            </svg>
          </div>
          <div>
            <h2>Gesti√≥n de Productos</h2>
            <p class="subtitle">Administra y visualiza tu cat√°logo de productos</p>
          </div>
        </div>
        <button class="btn-primary" (click)="irACrear()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          <span>Nuevo Producto</span>
        </button>
      </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Cargando productos...</p>
    </div>

    <!-- Error message -->
    <div *ngIf="error" class="error-message">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
      <span>{{ error }}</span>
    </div>

    <!-- Grid de productos -->
    <div class="productos-grid" *ngIf="!loading && productos.length > 0">
      <div class="producto-card" *ngFor="let producto of productos; let i = index" [style.animation-delay]="(i * 0.05) + 's'">
        
        <!-- üì∏ Imagen del producto -->
        <div class="product-image-container">
          <img 
            *ngIf="producto.foto_url" 
            [src]="producto.foto_url" 
            [alt]="producto.nombre"
            class="product-image"
            loading="lazy">
          <div *ngIf="!producto.foto_url" class="product-image-placeholder">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <circle cx="8.5" cy="8.5" r="1.5"></circle>
              <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
          </div>
        </div>
        
        <div class="card-header">
          <div class="product-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="1" y="3" width="15" height="13"></rect>
              <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
              <circle cx="5.5" cy="18.5" r="2.5"></circle>
              <circle cx="18.5" cy="18.5" r="2.5"></circle>
            </svg>
          </div>
          <h3>{{ producto.nombre }}</h3>
        </div>
        
        <div class="producto-info">
          <div class="info-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            <div>
              <span class="label">C√≥digo</span>
              <span class="value">{{ producto.codigo }}</span>
            </div>
          </div>
          
          <div class="info-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
              <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
              <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </svg>
            <div>
              <span class="label">Stock</span>
              <span class="value stock" [class.low-stock]="producto.stock < 10">{{ producto.stock }} unidades</span>
            </div>
          </div>
        </div>

        <div class="precio-container">
          <span class="precio-label">Precio</span>
          <span class="precio">${{ producto.precio | number:'1.0-0' }}</span>
        </div>

        <div class="producto-actions">
          <button class="btn-edit" (click)="editar(producto)" title="Editar producto">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            <span>Editar</span>
          </button>
          <button class="btn-delete" (click)="eliminar(producto.codigo)" title="Eliminar producto">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
            <span>Eliminar</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Empty state -->
    <div *ngIf="!loading && productos.length === 0" class="empty-state">
      <div class="empty-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
          <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
          <line x1="6" y1="6" x2="6.01" y2="6"></line>
          <line x1="6" y1="18" x2="6.01" y2="18"></line>
        </svg>
      </div>
      <h3>No hay productos registrados</h3>
      <p>Comienza creando tu primer producto para gestionar tu cat√°logo</p>
      <button class="btn-primary" (click)="irACrear()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        <span>Crear Primer Producto</span>
      </button>
    </div>
  </div>

  <!-- Modal de Edici√≥n -->
  <div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        </div>
        <h3>Editar Producto</h3>
        <p>Modifica la informaci√≥n del producto</p>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            C√≥digo
          </label>
          <input 
            type="text" 
            class="styled-input" 
            [(ngModel)]="productoEditando.codigo" 
            disabled
            placeholder="C√≥digo del producto">
        </div>

        <div class="form-group">
          <label>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
              <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
            </svg>
            Nombre
          </label>
          <input 
            type="text" 
            class="styled-input" 
            [(ngModel)]="productoEditando.nombre" 
            placeholder="Nombre del producto">
        </div>

        <div class="form-group">
          <label>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
            </svg>
            Stock
          </label>
          <input 
            type="number" 
            class="styled-input" 
            [(ngModel)]="productoEditando.stock" 
            min="0"
            placeholder="Cantidad en stock">
        </div>

        <div class="form-group">
          <label>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
            Precio
          </label>
          <input 
            type="number" 
            class="styled-input" 
            [(ngModel)]="productoEditando.precio" 
            min="0"
            step="0.01"
            placeholder="Precio del producto">
        </div>

        <!-- ‚≠ê SECCI√ìN DE DESCRIPCI√ìN IA -->
        <div class="ia-section">
          <h4 class="ia-title">
            <span class="ia-icon">ü§ñ</span>
            Descripci√≥n con IA
          </h4>
          
          <button 
            type="button"
            class="btn-ia"
            (click)="generarDescripcionIA()"
            [disabled]="cargandoDescripcion || !productoEditando.id">
            <span *ngIf="!cargandoDescripcion">‚ú® Generar con IA</span>
            <span *ngIf="cargandoDescripcion">
              <span class="spinner-ia"></span> Generando...
            </span>
          </button>

          <!-- Mostrar si ya tiene descripci√≥n -->
          <div class="descripcion-preview" *ngIf="productoEditando.descripcion_corta">
            <div class="preview-header">
              <span class="badge-guardado">‚úì Guardada en BD</span>
              <span class="fecha" *ngIf="productoEditando.descripcion_generada_fecha">
                {{ productoEditando.descripcion_generada_fecha | date:'dd/MM/yyyy HH:mm' }}
              </span>
            </div>
            
            <div class="descripcion-content">
              <h5>Descripci√≥n Corta:</h5>
              <p>{{ productoEditando.descripcion_corta }}</p>
              
              <h5>Descripci√≥n Larga:</h5>
              <p class="truncate">{{ productoEditando.descripcion_larga }}</p>
            </div>
          </div>

          <!-- Mensaje si no tiene descripci√≥n -->
          <div class="sin-descripcion" *ngIf="!productoEditando.descripcion_corta && productoEditando.id">
            <p class="hint">Este producto a√∫n no tiene descripci√≥n generada por IA</p>
          </div>
        </div>

        <div *ngIf="error" class="error-message">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          <span>{{ error }}</span>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-modal btn-save" (click)="guardarEdicion()" [disabled]="guardandoEdicion">
          <div *ngIf="guardandoEdicion" class="spinner"></div>
          <svg *ngIf="!guardandoEdicion" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          <span>{{ guardandoEdicion ? 'Guardando...' : 'Guardar Cambios' }}</span>
        </button>
        <button class="btn-modal btn-cancel" (click)="cerrarModal()" [disabled]="guardandoEdicion">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
          <span>Cancelar</span>
        </button>
      </div>
    </div>
  </div>
</div>
